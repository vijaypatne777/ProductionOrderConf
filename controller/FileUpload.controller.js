sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/core/format/DateFormat"],function(e,r,s){"use strict";return e.extend("Prod_Ord_Conf.Production_Ord_Conf.controller.FileUpload",{onInit:function(){this._pModel=this.getOwnerComponent().getModel("PORD");this._tModel=new sap.ui.model.json.JSONModel;this._msgModel=new sap.ui.model.json.JSONModel;this._oPromises=[];this._msgArr=[];this._msgData={msgs:this._msgArr};var e=this.byId("cUpload");e.setEnabled(false)},handleUploadPress:function(){var e=this;var s=[];var t=[];var a={prec:t};var o=this.byId("fileUploader");var i=this.byId("prodTable");if(!o.getValue()){r.show("Select the file first!");return}else{var n=o.getFocusDomRef();var d=n.files[0];if(d&&window.FileReader){var c=new FileReader;c.onload=function(r){var o=r.target.result;var n=o.match(/[\w .]+(?=,?)/g);var d=14;var c=n.splice(0,d);while(n.length>0){var u={};var l={};var p=n.splice(0,d);for(var m=0;m<p.length;m++){u[c[m]]=p[m].trim();switch(m){case 0:l["OrdNo"]=u[c[m]];break;case 1:l["OpNo"]=u[c[m]];break;case 2:l["Seq"]=u[c[m]];break;case 3:l["Ctype"]=u[c[m]];break;case 4:l["Quan"]=u[c[m]];break;case 5:l["Unit"]=u[c[m]];break;case 6:l["CTEXT"]=u[c[m]];break;case 7:var f=u[c[m]];l["ValidF"]=f.substr(0,4)+"-"+f.substr(4,2)+"-"+f.substr(6,2)+"T00:00:00";break;case 8:var h=u[c[m]];l["ValidFT"]="PT"+h.substr(0,2)+"H"+h.substr(2,2)+"M"+h.substr(4,2)+"S";break;case 9:var v=u[c[m]];l["ValidFE"]=v.substr(0,4)+"-"+v.substr(4,2)+"-"+v.substr(6,2)+"T00:00:00";break;case 10:var g=u[c[m]];l["ValidFET"]="PT"+g.substr(0,2)+"H"+g.substr(2,2)+"M"+g.substr(4,2)+"S";break;case 11:var b=u[c[m]];l["PDATE"]=b.substr(0,4)+"-"+b.substr(4,2)+"-"+b.substr(6,2)+"T00:00:00";break;case 12:l["BT"]=u[c[m]];break;case 13:l["PNO"]=u[c[m]];break}}s.push(u);t.push(l)}e._tModel.setData(a);i.setModel(e._tModel);var C=e.byId("cUpload");C.setEnabled(true)};c.readAsBinaryString(d)}}},createProdConfPress:function(){sap.ui.core.BusyIndicator.show();var e=this;var r=this._tModel.getData();var s=this._pModel;var t;for(var a=0;a<r.prec.length;a++){var o={};o.OrderID=r.prec[a].OrdNo;o.OrderOperation=r.prec[a].OpNo;o.Sequence=r.prec[a].Seq;if(r.prec[a].Ctype=="Y"){o.FinalConfirmationType="X"}o.ConfirmationYieldQuantity=r.prec[a].Quan;o.ConfirmationText=r.prec[a].CTEXT;o.ConfirmationUnit=r.prec[a].Unit;o.ConfirmedExecutionStartDate=r.prec[a].ValidF;o.ConfirmedExecutionStartTime=r.prec[a].ValidFT;o.ConfirmedProcessingEndDate=r.prec[a].ValidFE;o.ConfirmedProcessingEndTime=r.prec[a].ValidFET;o.PostingDate=r.prec[a].Pdate;o.ConfirmedBreakDuration=r.prec[a].BT;o.Personnel=r.prec[a].PNO;t="GID"+a;var i=new Promise(function(r,a){s.create("/ProdnOrdConf2",o,{success:function(s){var t={};t["Mtype"]="Success";t["Msg"]="Production Order Confirmattion created with Confirmation Group "+s.ConfirmationGroup+s.ConfirmationCount;e._msgArr.push(t);r()},error:function(r){var s={};s["Mtype"]="Error";s["Msg"]=r.responseText;e._msgArr.push(s);a()},groupId:t})});this._oPromises.push(i)}return this._oPromises},promiseCompleted:function(){this._msgData.msgs=this._msgArr;this._msgModel.setData(this._msgData);sap.ui.getCore().setModel(this._msgModel,"mModel");this.getOwnerComponent().getRouter().navTo("RLog")},handlePost:function(){var e=this;var s=0;Promise.allSettled=function(t){t.forEach(function(t){t.then(function(a){s=s+1;if(s===e._oPromises.length){sap.ui.core.BusyIndicator.hide();r.show(s+"Production Order Confirmation successfully Created");e.promiseCompleted()}return t},function(r){s=s+1;if(s===e._oPromises.length){sap.ui.core.BusyIndicator.hide();e.promiseCompleted()}})});return t};var t=[];t=this.createProdConfPress();var a=Promise.allSettled(t)}})});